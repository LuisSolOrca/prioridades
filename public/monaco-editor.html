<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de FÃ³rmulas KPI</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #1e1e1e;
            overflow: hidden;
        }
        #editor {
            width: 100%;
            height: 100vh;
        }
        .toolbar {
            background: #252526;
            padding: 8px;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .toolbar button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        .toolbar button:hover {
            background: #1177bb;
        }
        .toolbar .info {
            color: #d4d4d4;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <div class="info">
            ðŸ’¡ Escribe una letra para ver sugerencias automÃ¡ticas
        </div>
        <button onclick="saveAndClose()">âœ“ Guardar</button>
    </div>
    <div id="editor"></div>

    <script src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js"></script>
    <script>
        // Recibir fÃ³rmula inicial desde el parent
        const initialValue = new URLSearchParams(window.location.search).get('value') || '';

        // Funciones del sistema con sus parÃ¡metros y documentaciÃ³n completa
        const SYSTEM_FUNCTIONS = [
            {
                name: 'COUNT_PRIORITIES',
                signature: 'COUNT_PRIORITIES(filtros?)',
                description: 'Cuenta prioridades que cumplen ciertos criterios',
                documentation: `Cuenta el nÃºmero de prioridades segÃºn los criterios especificados.

**Filtros disponibles:**
â€¢ status: Estado de la prioridad (usa autocompletado)
â€¢ type: Tipo de prioridad
â€¢ userName: Nombre del usuario (usa autocompletado)
â€¢ initiativeName: Nombre de iniciativa (usa autocompletado)
â€¢ projectName: Nombre del proyecto (usa autocompletado)
â€¢ clientName: Nombre del cliente (usa autocompletado)
â€¢ isCarriedOver: Prioridades arrastradas (true/false)
â€¢ weekStart: Fecha inicio "YYYY-MM-DD"
â€¢ weekEnd: Fecha fin "YYYY-MM-DD"
â€¢ completionMin: % mÃ­nimo (0-100)
â€¢ completionMax: % mÃ¡ximo (0-100)

**Ejemplos:**
COUNT_PRIORITIES()
COUNT_PRIORITIES({status: "COMPLETADO"})
COUNT_PRIORITIES({userName: "Juan PÃ©rez", status: "EN_RIESGO"})
COUNT_PRIORITIES({initiativeName: "GeneraciÃ³n de ingresos"})`,
                detail: 'ðŸ“Š Sistema',
                params: ['status', 'type', 'userName', 'initiativeName', 'projectName', 'clientName', 'isCarriedOver', 'weekStart', 'weekEnd', 'completionMin', 'completionMax']
            },
            {
                name: 'SUM_PRIORITIES',
                signature: 'SUM_PRIORITIES(campo, filtros?)',
                description: 'Suma un campo numÃ©rico de las prioridades',
                documentation: `Suma el valor de un campo numÃ©rico en las prioridades filtradas.

**ParÃ¡metros:**
â€¢ campo: "completionPercentage" (entre comillas)
â€¢ filtros: Objeto con filtros (opcional)

**Filtros disponibles:**
â€¢ status, userName, initiativeName, projectName, etc.

**Ejemplos:**
SUM_PRIORITIES("completionPercentage")
SUM_PRIORITIES("completionPercentage", {status: "COMPLETADO"})
SUM_PRIORITIES("completionPercentage", {userName: "MarÃ­a LÃ³pez"})`,
                detail: 'ðŸ“Š Sistema',
                params: ['status', 'type', 'userName', 'initiativeName', 'projectName']
            },
            {
                name: 'AVG_PRIORITIES',
                signature: 'AVG_PRIORITIES(campo, filtros?)',
                description: 'Calcula el promedio de un campo numÃ©rico',
                documentation: `Calcula el promedio de un campo numÃ©rico en las prioridades filtradas.

**ParÃ¡metros:**
â€¢ campo: "completionPercentage" (entre comillas)
â€¢ filtros: Objeto con filtros (opcional)

**Ejemplos:**
AVG_PRIORITIES("completionPercentage")
AVG_PRIORITIES("completionPercentage", {status: "COMPLETADO"})
AVG_PRIORITIES("completionPercentage", {projectName: "Proyecto Alpha"})`,
                detail: 'ðŸ“Š Sistema',
                params: ['status', 'type', 'userName', 'initiativeName', 'projectName']
            },
            {
                name: 'COUNT_MILESTONES',
                signature: 'COUNT_MILESTONES(filtros?)',
                description: 'Cuenta hitos que cumplen ciertos criterios',
                documentation: `Cuenta hitos segÃºn los criterios especificados.

**Filtros disponibles:**
â€¢ userName: Nombre del usuario (usa autocompletado)
â€¢ projectName: Nombre del proyecto (usa autocompletado)
â€¢ isCompleted: Hitos completados (true/false)
â€¢ dueDateStart: Fecha desde "YYYY-MM-DD"
â€¢ dueDateEnd: Fecha hasta "YYYY-MM-DD"

**Ejemplos:**
COUNT_MILESTONES({isCompleted: true})
COUNT_MILESTONES({projectName: "Proyecto Beta"})
COUNT_MILESTONES({userName: "Carlos Ruiz", isCompleted: false})`,
                detail: 'ðŸ“Š Sistema',
                params: ['userName', 'projectName', 'isCompleted', 'dueDateStart', 'dueDateEnd']
            },
            {
                name: 'COUNT_PROJECTS',
                signature: 'COUNT_PROJECTS(filtros?)',
                description: 'Cuenta proyectos',
                documentation: `Cuenta proyectos segÃºn los criterios especificados.

**Filtros disponibles:**
â€¢ isActive: Proyectos activos (true/false)
â€¢ projectManagerName: Nombre del gerente (usa autocompletado)

**Ejemplos:**
COUNT_PROJECTS({isActive: true})
COUNT_PROJECTS({projectManagerName: "Ana GarcÃ­a"})`,
                detail: 'ðŸ“Š Sistema',
                params: ['isActive', 'projectManagerName']
            },
            {
                name: 'COUNT_USERS',
                signature: 'COUNT_USERS(filtros?)',
                description: 'Cuenta usuarios del sistema',
                documentation: `Cuenta usuarios segÃºn los criterios especificados.

**Filtros disponibles:**
â€¢ role: Rol del usuario (usa autocompletado)
â€¢ area: Ãrea o departamento (usa autocompletado)
â€¢ isActive: Usuarios activos (true/false)
â€¢ isAreaLeader: LÃ­deres de Ã¡rea (true/false)

**Ejemplos:**
COUNT_USERS({area: "TecnologÃ­a"})
COUNT_USERS({role: "ADMIN"})
COUNT_USERS({area: "Ventas", isActive: true})`,
                detail: 'ðŸ“Š Sistema',
                params: ['role', 'area', 'isActive', 'isAreaLeader']
            },
            {
                name: 'COMPLETION_RATE',
                signature: 'COMPLETION_RATE(filtros?)',
                description: 'Calcula tasa de cumplimiento (%)',
                documentation: `Calcula el porcentaje de prioridades completadas.

**Filtros disponibles:** (mismos que COUNT_PRIORITIES)
â€¢ userName, initiativeName, projectName, weekStart, weekEnd, etc.

**Ejemplos:**
COMPLETION_RATE()
COMPLETION_RATE({userName: "Pedro SÃ¡nchez"})
COMPLETION_RATE({initiativeName: "Eficiencia Operativa"})
COMPLETION_RATE({weekStart: "2025-01-01", weekEnd: "2025-01-31"})`,
                detail: 'ðŸ“Š Sistema',
                params: ['userName', 'initiativeName', 'projectName', 'weekStart', 'weekEnd', 'status']
            },
            {
                name: 'PERCENTAGE',
                signature: 'PERCENTAGE(parte, total)',
                description: 'Calcula porcentaje: (parte / total) * 100',
                documentation: `FunciÃ³n auxiliar para calcular porcentajes.

**ParÃ¡metros:**
â€¢ parte: Valor parcial (nÃºmero)
â€¢ total: Valor total (nÃºmero)

**Retorna:** (parte / total) * 100

**Ejemplo:**
PERCENTAGE(25, 100) // = 25
PERCENTAGE(COUNT_PRIORITIES({status: "COMPLETADO"}), COUNT_PRIORITIES())`,
                detail: 'ðŸ“Š Sistema',
                params: []
            }
        ];

        // Datos de autocompletado (se cargarÃ¡n del servidor)
        let autocompleteData = null;

        // Cargar datos de autocompletado
        async function loadAutocompleteData() {
            try {
                const response = await fetch('/api/kpis/autocomplete-data');
                if (response.ok) {
                    autocompleteData = await response.json();
                }
            } catch (error) {
                console.warn('No se pudieron cargar datos de autocompletado:', error);
            }
        }

        loadAutocompleteData();

        // Funciones de Excel completas (382 funciones de hot-formula-parser)
        const EXCEL_FUNCTIONS = [
  { name: 'ABS', signature: 'ABS(number)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'ACCRINT', signature: 'ACCRINT(issue, first_interest, settlement, rate, par, frequency, [basis], [calc_method])', detail: 'ðŸ’° Financieras' },
  { name: 'ACOS', signature: 'ACOS(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'ACOSH', signature: 'ACOSH(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'ACOT', signature: 'ACOT(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'ACOTH', signature: 'ACOTH(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'ADD', signature: 'ADD()', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'AGGREGATE', signature: 'AGGREGATE(function_num, options, ref1, [ref2], ...)', detail: 'ðŸ“¦ Otras' },
  { name: 'AND', signature: 'AND(logical1, [logical2], ...)', detail: 'ðŸ”€ LÃ³gicas' },
  { name: 'ARABIC', signature: 'ARABIC(text)', detail: 'ðŸ“¦ Otras' },
  { name: 'ARGS2ARRAY', signature: 'ARGS2ARRAY()', detail: 'ðŸ“¦ Otras' },
  { name: 'ASIN', signature: 'ASIN(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'ASINH', signature: 'ASINH(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'ATAN', signature: 'ATAN(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'ATAN2', signature: 'ATAN2(x_num, y_num)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'ATANH', signature: 'ATANH(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'AVEDEV', signature: 'AVEDEV(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'AVERAGE', signature: 'AVERAGE(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'AVERAGEA', signature: 'AVERAGEA(value1, [value2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'AVERAGEIF', signature: 'AVERAGEIF(range, criteria, [average_range])', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'AVERAGEIFS', signature: 'AVERAGEIFS(average_range, criteria_range1, criteria1, [criteria_range2, criteria2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'BASE', signature: 'BASE(number, radix, [min_length])', detail: 'ðŸ“¦ Otras' },
  { name: 'BESSELI', signature: 'BESSELI()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'BESSELJ', signature: 'BESSELJ()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'BESSELK', signature: 'BESSELK()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'BESSELY', signature: 'BESSELY()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'BETA.DIST', signature: 'BETA.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'BETA.INV', signature: 'BETA.INV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'BETADIST', signature: 'BETADIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'BETAINV', signature: 'BETAINV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'BIN2DEC', signature: 'BIN2DEC()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'BIN2HEX', signature: 'BIN2HEX()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'BIN2OCT', signature: 'BIN2OCT()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'BINOM.DIST', signature: 'BINOM.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'BINOM.DIST.RANGE', signature: 'BINOM.DIST.RANGE()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'BINOM.INV', signature: 'BINOM.INV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'BINOMDIST', signature: 'BINOMDIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'BITAND', signature: 'BITAND()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'BITLSHIFT', signature: 'BITLSHIFT()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'BITOR', signature: 'BITOR()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'BITRSHIFT', signature: 'BITRSHIFT()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'BITXOR', signature: 'BITXOR()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'CEILING', signature: 'CEILING(number, significance)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'CEILINGMATH', signature: 'CEILINGMATH()', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'CEILINGPRECISE', signature: 'CEILINGPRECISE()', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'CHAR', signature: 'CHAR(number)', detail: 'ðŸ“ Texto' },
  { name: 'CHISQ.DIST', signature: 'CHISQ.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'CHISQ.DIST.RT', signature: 'CHISQ.DIST.RT()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'CHISQ.INV', signature: 'CHISQ.INV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'CHISQ.INV.RT', signature: 'CHISQ.INV.RT()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'CHOOSE', signature: 'CHOOSE(index_num, value1, [value2], ...)', detail: 'ðŸ”§ Utilidades' },
  { name: 'CLEAN', signature: 'CLEAN(text)', detail: 'ðŸ“ Texto' },
  { name: 'CODE', signature: 'CODE(text)', detail: 'ðŸ“ Texto' },
  { name: 'COLUMN', signature: 'COLUMN([reference])', detail: 'ðŸ”§ Utilidades' },
  { name: 'COLUMNS', signature: 'COLUMNS(array)', detail: 'ðŸ”§ Utilidades' },
  { name: 'COMBIN', signature: 'COMBIN(number, number_chosen)', detail: 'ðŸ”§ Utilidades' },
  { name: 'COMBINA', signature: 'COMBINA(number, number_chosen)', detail: 'ðŸ”§ Utilidades' },
  { name: 'COMPLEX', signature: 'COMPLEX()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'CONCATENATE', signature: 'CONCATENATE(text1, [text2], ...)', detail: 'ðŸ“ Texto' },
  { name: 'CONFIDENCE', signature: 'CONFIDENCE()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'CONFIDENCE.NORM', signature: 'CONFIDENCE.NORM()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'CONFIDENCE.T', signature: 'CONFIDENCE.T()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'CONVERT', signature: 'CONVERT()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'CORREL', signature: 'CORREL()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'COS', signature: 'COS(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'COSH', signature: 'COSH(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'COT', signature: 'COT(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'COTH', signature: 'COTH(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'COVARIANCE.P', signature: 'COVARIANCE.P()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'COVARIANCE.S', signature: 'COVARIANCE.S()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'COUNT', signature: 'COUNT(value1, [value2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'COUNTA', signature: 'COUNTA(value1, [value2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'COUNTBLANK', signature: 'COUNTBLANK(range)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'COUNTIF', signature: 'COUNTIF(range, criteria)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'COUNTIFS', signature: 'COUNTIFS(criteria_range1, criteria1, [criteria_range2, criteria2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'COUNTIN', signature: 'COUNTIN()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'COUNTUNIQUE', signature: 'COUNTUNIQUE()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'CSC', signature: 'CSC(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'CSCH', signature: 'CSCH(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'CUMIPMT', signature: 'CUMIPMT(rate, nper, pv, start_period, end_period, type)', detail: 'ðŸ’° Financieras' },
  { name: 'CUMPRINC', signature: 'CUMPRINC(rate, nper, pv, start_period, end_period, type)', detail: 'ðŸ’° Financieras' },
  { name: 'DATE', signature: 'DATE(year, month, day)', detail: 'ðŸ“… Fechas' },
  { name: 'DATEVALUE', signature: 'DATEVALUE(date_text)', detail: 'ðŸ“… Fechas' },
  { name: 'DAY', signature: 'DAY(serial_number)', detail: 'ðŸ“… Fechas' },
  { name: 'DAYS', signature: 'DAYS(end_date, start_date)', detail: 'ðŸ“… Fechas' },
  { name: 'DAYS360', signature: 'DAYS360(start_date, end_date, [method])', detail: 'ðŸ“… Fechas' },
  { name: 'DB', signature: 'DB(cost, salvage, life, period, [month])', detail: 'ðŸ’° Financieras' },
  { name: 'DDB', signature: 'DDB(cost, salvage, life, period, [factor])', detail: 'ðŸ’° Financieras' },
  { name: 'DEC2BIN', signature: 'DEC2BIN()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'DEC2HEX', signature: 'DEC2HEX()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'DEC2OCT', signature: 'DEC2OCT()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'DECIMAL', signature: 'DECIMAL(text, radix)', detail: 'ðŸ“¦ Otras' },
  { name: 'DEGREES', signature: 'DEGREES(angle)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'DELTA', signature: 'DELTA()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'DEVSQ', signature: 'DEVSQ(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'DIVIDE', signature: 'DIVIDE()', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'DOLLARDE', signature: 'DOLLARDE(fractional_dollar, fraction)', detail: 'ðŸ’° Financieras' },
  { name: 'DOLLARFR', signature: 'DOLLARFR(decimal_dollar, fraction)', detail: 'ðŸ’° Financieras' },
  { name: 'E', signature: 'E()', detail: 'ðŸ”§ Utilidades' },
  { name: 'EDATE', signature: 'EDATE(start_date, months)', detail: 'ðŸ“… Fechas' },
  { name: 'EFFECT', signature: 'EFFECT(nominal_rate, npery)', detail: 'ðŸ’° Financieras' },
  { name: 'EOMONTH', signature: 'EOMONTH(start_date, months)', detail: 'ðŸ“… Fechas' },
  { name: 'EQ', signature: 'EQ()', detail: 'ðŸ“¦ Otras' },
  { name: 'ERF', signature: 'ERF()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'ERFC', signature: 'ERFC()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'EVEN', signature: 'EVEN(number)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'EXACT', signature: 'EXACT(text1, text2)', detail: 'ðŸ“ Texto' },
  { name: 'EXP', signature: 'EXP(number)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'EXPON.DIST', signature: 'EXPON.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'EXPONDIST', signature: 'EXPONDIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'F.DIST', signature: 'F.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'F.DIST.RT', signature: 'F.DIST.RT()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'F.INV', signature: 'F.INV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'F.INV.RT', signature: 'F.INV.RT()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'FACT', signature: 'FACT(number)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'FACTDOUBLE', signature: 'FACTDOUBLE(number)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'FALSE', signature: 'FALSE()', detail: 'ðŸ”€ LÃ³gicas' },
  { name: 'FDIST', signature: 'FDIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'FDISTRT', signature: 'FDISTRT()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'FIND', signature: 'FIND(find_text, within_text, [start_num])', detail: 'ðŸ“ Texto' },
  { name: 'FINV', signature: 'FINV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'FINVRT', signature: 'FINVRT()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'FISHER', signature: 'FISHER()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'FISHERINV', signature: 'FISHERINV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'FLATTEN', signature: 'FLATTEN()', detail: 'ðŸ”§ Utilidades' },
  { name: 'FLOOR', signature: 'FLOOR(number, significance)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'FORECAST', signature: 'FORECAST()', detail: 'ðŸ”§ Utilidades' },
  { name: 'FREQUENCY', signature: 'FREQUENCY()', detail: 'ðŸ”§ Utilidades' },
  { name: 'FV', signature: 'FV(rate, nper, pmt, [pv], [type])', detail: 'ðŸ’° Financieras' },
  { name: 'FVSCHEDULE', signature: 'FVSCHEDULE(principal, schedule)', detail: 'ðŸ’° Financieras' },
  { name: 'GAMMA', signature: 'GAMMA()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'GAMMA.DIST', signature: 'GAMMA.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'GAMMA.INV', signature: 'GAMMA.INV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'GAMMADIST', signature: 'GAMMADIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'GAMMAINV', signature: 'GAMMAINV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'GAMMALN', signature: 'GAMMALN()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'GAMMALN.PRECISE', signature: 'GAMMALN.PRECISE()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'GAUSS', signature: 'GAUSS()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'GCD', signature: 'GCD(number1, [number2], ...)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'GEOMEAN', signature: 'GEOMEAN()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'GESTEP', signature: 'GESTEP()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'GROWTH', signature: 'GROWTH()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'GTE', signature: 'GTE()', detail: 'ðŸ“¦ Otras' },
  { name: 'HARMEAN', signature: 'HARMEAN()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'HEX2BIN', signature: 'HEX2BIN()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'HEX2DEC', signature: 'HEX2DEC()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'HEX2OCT', signature: 'HEX2OCT()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'HOUR', signature: 'HOUR(serial_number)', detail: 'ðŸ“… Fechas' },
  { name: 'HTML2TEXT', signature: 'HTML2TEXT()', detail: 'ðŸ“¦ Otras' },
  { name: 'HYPGEOM.DIST', signature: 'HYPGEOM.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'HYPGEOMDIST', signature: 'HYPGEOMDIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'IF', signature: 'IF(logical_test, value_if_true, [value_if_false])', detail: 'ðŸ”€ LÃ³gicas' },
  { name: 'IMABS', signature: 'IMABS()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMAGINARY', signature: 'IMAGINARY()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMARGUMENT', signature: 'IMARGUMENT()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMCONJUGATE', signature: 'IMCONJUGATE()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMCOS', signature: 'IMCOS()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMCOSH', signature: 'IMCOSH()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMCOT', signature: 'IMCOT()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMCSC', signature: 'IMCSC()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMCSCH', signature: 'IMCSCH()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMDIV', signature: 'IMDIV()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMEXP', signature: 'IMEXP()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMLN', signature: 'IMLN()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMLOG10', signature: 'IMLOG10()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMLOG2', signature: 'IMLOG2()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMPOWER', signature: 'IMPOWER()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMPRODUCT', signature: 'IMPRODUCT()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMREAL', signature: 'IMREAL()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMSEC', signature: 'IMSEC()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMSECH', signature: 'IMSECH()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMSIN', signature: 'IMSIN()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMSINH', signature: 'IMSINH()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMSQRT', signature: 'IMSQRT()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMSUB', signature: 'IMSUB()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMSUM', signature: 'IMSUM()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'IMTAN', signature: 'IMTAN()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'INT', signature: 'INT(number)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'INTERCEPT', signature: 'INTERCEPT()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'INTERVAL', signature: 'INTERVAL()', detail: 'ðŸ“… Fechas' },
  { name: 'IPMT', signature: 'IPMT(rate, per, nper, pv, [fv], [type])', detail: 'ðŸ’° Financieras' },
  { name: 'IRR', signature: 'IRR(values, [guess])', detail: 'ðŸ’° Financieras' },
  { name: 'ISBINARY', signature: 'ISBINARY()', detail: 'ðŸ”§ Utilidades' },
  { name: 'ISBLANK', signature: 'ISBLANK(value)', detail: 'ðŸ”§ Utilidades' },
  { name: 'ISEVEN', signature: 'ISEVEN(number)', detail: 'ðŸ”§ Utilidades' },
  { name: 'ISLOGICAL', signature: 'ISLOGICAL(value)', detail: 'ðŸ”§ Utilidades' },
  { name: 'ISNONTEXT', signature: 'ISNONTEXT(value)', detail: 'ðŸ”§ Utilidades' },
  { name: 'ISNUMBER', signature: 'ISNUMBER(number)', detail: 'ðŸ”§ Utilidades' },
  { name: 'ISODD', signature: 'ISODD(number)', detail: 'ðŸ”§ Utilidades' },
  { name: 'ISOWEEKNUM', signature: 'ISOWEEKNUM(date)', detail: 'ðŸ“… Fechas' },
  { name: 'ISPMT', signature: 'ISPMT(rate, per, nper, pv)', detail: 'ðŸ’° Financieras' },
  { name: 'ISTEXT', signature: 'ISTEXT(value)', detail: 'ðŸ”§ Utilidades' },
  { name: 'JOIN', signature: 'JOIN()', detail: 'ðŸ“ Texto' },
  { name: 'KURT', signature: 'KURT()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'LARGE', signature: 'LARGE(array, k)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'LCM', signature: 'LCM(number1, [number2], ...)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'LEFT', signature: 'LEFT(text, [num_chars])', detail: 'ðŸ“ Texto' },
  { name: 'LEN', signature: 'LEN(text)', detail: 'ðŸ“ Texto' },
  { name: 'LINEST', signature: 'LINEST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'LN', signature: 'LN(number)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'LOG', signature: 'LOG(number, [base])', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'LOG10', signature: 'LOG10(number)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'LOGEST', signature: 'LOGEST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'LOGNORM.DIST', signature: 'LOGNORM.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'LOGNORM.INV', signature: 'LOGNORM.INV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'LOGNORMDIST', signature: 'LOGNORMDIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'LOGNORMINV', signature: 'LOGNORMINV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'LOWER', signature: 'LOWER(text)', detail: 'ðŸ“ Texto' },
  { name: 'LT', signature: 'LT()', detail: 'ðŸ“¦ Otras' },
  { name: 'LTE', signature: 'LTE()', detail: 'ðŸ“¦ Otras' },
  { name: 'MATCH', signature: 'MATCH(lookup_value, lookup_array, [match_type])', detail: 'ðŸ”§ Utilidades' },
  { name: 'MAX', signature: 'MAX(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'MAXA', signature: 'MAXA(value1, [value2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'MEDIAN', signature: 'MEDIAN(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'MID', signature: 'MID(text, start_num, num_chars)', detail: 'ðŸ“ Texto' },
  { name: 'MIN', signature: 'MIN(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'MINA', signature: 'MINA(value1, [value2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'MINUS', signature: 'MINUS()', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'MINUTE', signature: 'MINUTE(serial_number)', detail: 'ðŸ“… Fechas' },
  { name: 'MIRR', signature: 'MIRR(values, finance_rate, reinvest_rate)', detail: 'ðŸ’° Financieras' },
  { name: 'MOD', signature: 'MOD(number, divisor)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'MODE.MULT', signature: 'MODE.MULT(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'MODE.SNGL', signature: 'MODE.SNGL(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'MODEMULT', signature: 'MODEMULT()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'MODESNGL', signature: 'MODESNGL()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'MONTH', signature: 'MONTH(serial_number)', detail: 'ðŸ“… Fechas' },
  { name: 'MROUND', signature: 'MROUND(number, multiple)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'MULTINOMIAL', signature: 'MULTINOMIAL(number1, [number2], ...)', detail: 'ðŸ”§ Utilidades' },
  { name: 'MULTIPLY', signature: 'MULTIPLY()', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'NE', signature: 'NE()', detail: 'ðŸ“¦ Otras' },
  { name: 'NEGBINOM.DIST', signature: 'NEGBINOM.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'NEGBINOMDIST', signature: 'NEGBINOMDIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'NETWORKDAYS', signature: 'NETWORKDAYS(start_date, end_date, [holidays])', detail: 'ðŸ“… Fechas' },
  { name: 'NOMINAL', signature: 'NOMINAL(effect_rate, npery)', detail: 'ðŸ’° Financieras' },
  { name: 'NORM.DIST', signature: 'NORM.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'NORM.INV', signature: 'NORM.INV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'NORM.S.DIST', signature: 'NORM.S.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'NORM.S.INV', signature: 'NORM.S.INV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'NORMDIST', signature: 'NORMDIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'NORMINV', signature: 'NORMINV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'NORMSDIST', signature: 'NORMSDIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'NORMSINV', signature: 'NORMSINV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'NOT', signature: 'NOT(logical)', detail: 'ðŸ”€ LÃ³gicas' },
  { name: 'NOW', signature: 'NOW()', detail: 'ðŸ“… Fechas' },
  { name: 'NPER', signature: 'NPER(rate, pmt, pv, [fv], [type])', detail: 'ðŸ’° Financieras' },
  { name: 'NPV', signature: 'NPV(rate, value1, [value2], ...)', detail: 'ðŸ’° Financieras' },
  { name: 'NUMBERS', signature: 'NUMBERS()', detail: 'ðŸ”§ Utilidades' },
  { name: 'OCT2BIN', signature: 'OCT2BIN()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'OCT2DEC', signature: 'OCT2DEC()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'OCT2HEX', signature: 'OCT2HEX()', detail: 'âš™ï¸ IngenierÃ­a' },
  { name: 'ODD', signature: 'ODD(number)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'OR', signature: 'OR(logical1, [logical2], ...)', detail: 'ðŸ”€ LÃ³gicas' },
  { name: 'PDURATION', signature: 'PDURATION(rate, pv, fv)', detail: 'ðŸ’° Financieras' },
  { name: 'PEARSON', signature: 'PEARSON()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'PERCENTILEEXC', signature: 'PERCENTILEEXC()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'PERCENTILEINC', signature: 'PERCENTILEINC()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'PERCENTRANKEXC', signature: 'PERCENTRANKEXC()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'PERCENTRANKINC', signature: 'PERCENTRANKINC()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'PERMUT', signature: 'PERMUT()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'PERMUTATIONA', signature: 'PERMUTATIONA()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'PHI', signature: 'PHI()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'PI', signature: 'PI()', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'PMT', signature: 'PMT(rate, nper, pv, [fv], [type])', detail: 'ðŸ’° Financieras' },
  { name: 'POISSON.DIST', signature: 'POISSON.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'POISSONDIST', signature: 'POISSONDIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'POW', signature: 'POW(number, power)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'POWER', signature: 'POWER(number, power)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'PPMT', signature: 'PPMT(rate, per, nper, pv, [fv], [type])', detail: 'ðŸ’° Financieras' },
  { name: 'PROB', signature: 'PROB()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'PRODUCT', signature: 'PRODUCT(number1, [number2], ...)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'PROPER', signature: 'PROPER(text)', detail: 'ðŸ“ Texto' },
  { name: 'PV', signature: 'PV(rate, nper, pmt, [fv], [type])', detail: 'ðŸ“¦ Otras' },
  { name: 'QUARTILE.EXC', signature: 'QUARTILE.EXC(array, quart)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'QUARTILE.INC', signature: 'QUARTILE.INC(array, quart)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'QUARTILEEXC', signature: 'QUARTILEEXC()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'QUARTILEINC', signature: 'QUARTILEINC()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'QUOTIENT', signature: 'QUOTIENT(numerator, denominator)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'RADIANS', signature: 'RADIANS(angle)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'RAND', signature: 'RAND()', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'RANDBETWEEN', signature: 'RANDBETWEEN(bottom, top)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'RANK.AVG', signature: 'RANK.AVG(number, ref, [order])', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'RANK.EQ', signature: 'RANK.EQ(number, ref, [order])', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'RANKAVG', signature: 'RANKAVG()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'RANKEQ', signature: 'RANKEQ()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'RATE', signature: 'RATE(nper, pmt, pv, [fv], [type], [guess])', detail: 'ðŸ’° Financieras' },
  { name: 'REFERENCE', signature: 'REFERENCE()', detail: 'ðŸ”§ Utilidades' },
  { name: 'REGEXEXTRACT', signature: 'REGEXEXTRACT()', detail: 'ðŸ“ Texto' },
  { name: 'REGEXMATCH', signature: 'REGEXMATCH()', detail: 'ðŸ“ Texto' },
  { name: 'REGEXREPLACE', signature: 'REGEXREPLACE()', detail: 'ðŸ“ Texto' },
  { name: 'REPLACE', signature: 'REPLACE(old_text, start_num, num_chars, new_text)', detail: 'ðŸ“ Texto' },
  { name: 'REPT', signature: 'REPT(text, number_times)', detail: 'ðŸ“ Texto' },
  { name: 'RIGHT', signature: 'RIGHT(text, [num_chars])', detail: 'ðŸ“ Texto' },
  { name: 'ROMAN', signature: 'ROMAN(number, [form])', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'ROUND', signature: 'ROUND(number, num_digits)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'ROUNDDOWN', signature: 'ROUNDDOWN(number, num_digits)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'ROUNDUP', signature: 'ROUNDUP(number, num_digits)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'ROW', signature: 'ROW([reference])', detail: 'ðŸ”§ Utilidades' },
  { name: 'ROWS', signature: 'ROWS(array)', detail: 'ðŸ”§ Utilidades' },
  { name: 'RRI', signature: 'RRI(nper, pv, fv)', detail: 'ðŸ’° Financieras' },
  { name: 'RSQ', signature: 'RSQ()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'SEARCH', signature: 'SEARCH(find_text, within_text, [start_num])', detail: 'ðŸ“ Texto' },
  { name: 'SEC', signature: 'SEC(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'SECH', signature: 'SECH(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'SECOND', signature: 'SECOND(serial_number)', detail: 'ðŸ“… Fechas' },
  { name: 'SERIESSUM', signature: 'SERIESSUM()', detail: 'ðŸ”§ Utilidades' },
  { name: 'SIGN', signature: 'SIGN(number)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'SIN', signature: 'SIN(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'SINH', signature: 'SINH(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'SKEW', signature: 'SKEW()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'SKEW.P', signature: 'SKEW.P()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'SKEWP', signature: 'SKEWP()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'SLN', signature: 'SLN(cost, salvage, life)', detail: 'ðŸ’° Financieras' },
  { name: 'SLOPE', signature: 'SLOPE()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'SMALL', signature: 'SMALL(array, k)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'SPLIT', signature: 'SPLIT()', detail: 'ðŸ“ Texto' },
  { name: 'SQRT', signature: 'SQRT(number)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'SQRTPI', signature: 'SQRTPI(number)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'STANDARDIZE', signature: 'STANDARDIZE()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'STDEV.P', signature: 'STDEV.P(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'STDEV.S', signature: 'STDEV.S(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'STDEVA', signature: 'STDEVA(value1, [value2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'STDEVP', signature: 'STDEV.P(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'STDEVPA', signature: 'STDEV.PA(value1, [value2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'STDEVS', signature: 'STDEV.S(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'STEYX', signature: 'STEYX()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'SUBSTITUTE', signature: 'SUBSTITUTE(text, old_text, new_text, [instance_num])', detail: 'ðŸ“ Texto' },
  { name: 'SUBTOTAL', signature: 'SUBTOTAL(function_num, ref1, [ref2], ...)', detail: 'ðŸ“¦ Otras' },
  { name: 'SUM', signature: 'SUM(number1, [number2], ...)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'SUMIF', signature: 'SUMIF(range, criteria, [sum_range])', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'SUMIFS', signature: 'SUMIFS(sum_range, criteria_range1, criteria1, [criteria_range2, criteria2], ...)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'SUMPRODUCT', signature: 'SUMPRODUCT(array1, [array2], ...)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'SUMSQ', signature: 'SUMSQ(number1, [number2], ...)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'SUMX2MY2', signature: 'SUMX2MY2(array_x, array_y)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'SUMX2PY2', signature: 'SUMX2PY2(array_x, array_y)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'SUMXMY2', signature: 'SUMXMY2(array_x, array_y)', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'SWITCH', signature: 'SWITCH(expression, val1, result1, [val2, result2], ..., [default])', detail: 'ðŸ”€ LÃ³gicas' },
  { name: 'SYD', signature: 'SYD(cost, salvage, life, period)', detail: 'ðŸ’° Financieras' },
  { name: 'T', signature: 'T(value)', detail: 'ðŸ“ Texto' },
  { name: 'T.DIST', signature: 'T.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'T.DIST.2T', signature: 'T.DIST.2T()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'T.DIST.RT', signature: 'T.DIST.RT()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'T.INV', signature: 'T.INV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'T.INV.2T', signature: 'T.INV.2T()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'TAN', signature: 'TAN(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'TANH', signature: 'TANH(number)', detail: 'ðŸ“ TrigonomÃ©tricas' },
  { name: 'TBILLEQ', signature: 'TBILLEQ(settlement, maturity, discount)', detail: 'ðŸ’° Financieras' },
  { name: 'TBILLPRICE', signature: 'TBILLPRICE(settlement, maturity, discount)', detail: 'ðŸ’° Financieras' },
  { name: 'TBILLYIELD', signature: 'TBILLYIELD(settlement, maturity, pr)', detail: 'ðŸ’° Financieras' },
  { name: 'TDIST', signature: 'TDIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'TDIST2T', signature: 'TDIST2T()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'TDISTRT', signature: 'TDISTRT()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'TIME', signature: 'TIME(hour, minute, second)', detail: 'ðŸ“… Fechas' },
  { name: 'TIMEVALUE', signature: 'TIMEVALUE(time_text)', detail: 'ðŸ“… Fechas' },
  { name: 'TINV', signature: 'TINV()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'TINV2T', signature: 'TINV2T()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'TODAY', signature: 'TODAY()', detail: 'ðŸ“… Fechas' },
  { name: 'TRANSPOSE', signature: 'TRANSPOSE(array)', detail: 'ðŸ”§ Utilidades' },
  { name: 'TREND', signature: 'TREND()', detail: 'ðŸ”§ Utilidades' },
  { name: 'TRIM', signature: 'TRIM(text)', detail: 'ðŸ“ Texto' },
  { name: 'TRIMMEAN', signature: 'TRIMMEAN()', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'TRUE', signature: 'TRUE()', detail: 'ðŸ”€ LÃ³gicas' },
  { name: 'TRUNC', signature: 'TRUNC(number, [num_digits])', detail: 'ðŸ”¢ MatemÃ¡ticas' },
  { name: 'UNICHAR', signature: 'UNICHAR(number)', detail: 'ðŸ“ Texto' },
  { name: 'UNICODE', signature: 'UNICODE(text)', detail: 'ðŸ“ Texto' },
  { name: 'UNIQUE', signature: 'UNIQUE(array, [by_col], [exactly_once])', detail: 'ðŸ”§ Utilidades' },
  { name: 'UPPER', signature: 'UPPER(text)', detail: 'ðŸ“ Texto' },
  { name: 'VAR.P', signature: 'VAR.P(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'VAR.S', signature: 'VAR.S(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'VARA', signature: 'VAR.A(value1, [value2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'VARP', signature: 'VAR.P(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'VARPA', signature: 'VAR.PA(value1, [value2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'VARS', signature: 'VAR.S(number1, [number2], ...)', detail: 'ðŸ“Š EstadÃ­sticas' },
  { name: 'WEEKDAY', signature: 'WEEKDAY(serial_number, [return_type])', detail: 'ðŸ“… Fechas' },
  { name: 'WEEKNUM', signature: 'WEEKNUM(serial_num, [return_type])', detail: 'ðŸ“… Fechas' },
  { name: 'WEIBULL.DIST', signature: 'WEIBULL.DIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'WEIBULLDIST', signature: 'WEIBULLDIST()', detail: 'ðŸ“ˆ Distribuciones' },
  { name: 'WORKDAY', signature: 'WORKDAY(start_date, days, [holidays])', detail: 'ðŸ“… Fechas' },
  { name: 'XIRR', signature: 'XIRR(values, dates, [guess])', detail: 'ðŸ’° Financieras' },
  { name: 'XNPV', signature: 'XNPV(rate, values, dates)', detail: 'ðŸ’° Financieras' },
  { name: 'XOR', signature: 'XOR(logical1, [logical2], ...)', detail: 'ðŸ”€ LÃ³gicas' },
  { name: 'YEAR', signature: 'YEAR(serial_number)', detail: 'ðŸ“… Fechas' },
  { name: 'YEARFRAC', signature: 'YEARFRAC(start_date, end_date, [basis])', detail: 'ðŸ“… Fechas' }
        ];

        let editor;

        require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@latest/min/vs' } });

        require(['vs/editor/editor.main'], function () {
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: decodeURIComponent(initialValue),
                language: 'plaintext',
                theme: 'vs-dark',
                fontSize: 14,
                minimap: { enabled: false },
                lineNumbers: 'off',
                wordWrap: 'on',
                quickSuggestions: {
                    other: true,
                    comments: false,
                    strings: false,
                },
                quickSuggestionsDelay: 10,
                suggestOnTriggerCharacters: true,
                wordBasedSuggestions: 'off',
                suggest: {
                    showWords: false,
                    showSnippets: true,
                    filterGraceful: true,
                },
            });

            // Registrar provider con autocompletado de parÃ¡metros
            monaco.languages.registerCompletionItemProvider('plaintext', {
                triggerCharacters: ['(', ',', ' ', ':', '"', '{'],

                provideCompletionItems: function(model, position) {
                    const word = model.getWordUntilPosition(position);
                    const range = {
                        startLineNumber: position.lineNumber,
                        endLineNumber: position.lineNumber,
                        startColumn: word.startColumn,
                        endColumn: word.endColumn,
                    };

                    const textUntilPosition = model.getValueInRange({
                        startLineNumber: 1,
                        startColumn: 1,
                        endLineNumber: position.lineNumber,
                        endColumn: position.column,
                    });

                    const lineText = model.getLineContent(position.lineNumber);
                    const beforeCursor = lineText.substring(0, position.column - 1);
                    const wordUpper = word.word.toUpperCase();

                    let suggestions = [];

                    // Detectar si estamos dentro de una funciÃ³n del sistema
                    const inSystemFunction = SYSTEM_FUNCTIONS.find(fn => {
                        const functionStart = textUntilPosition.lastIndexOf(fn.name + '(');
                        if (functionStart === -1) return false;

                        const afterFunction = textUntilPosition.substring(functionStart);
                        const openParens = (afterFunction.match(/\(/g) || []).length;
                        const closeParens = (afterFunction.match(/\)/g) || []).length;

                        return openParens > closeParens;
                    });

                    // Detectar si estamos dentro de {}
                    const insideObjectBraces = () => {
                        let braceCount = 0;
                        for (let i = textUntilPosition.length - 1; i >= 0; i--) {
                            if (textUntilPosition[i] === '}') braceCount++;
                            if (textUntilPosition[i] === '{') {
                                braceCount--;
                                if (braceCount < 0) return true;
                            }
                        }
                        return false;
                    };

                    // Detectar si estamos dentro de ""
                    const insideQuotes = () => {
                        const quotesBeforeCursor = (beforeCursor.match(/"/g) || []).length;
                        return quotesBeforeCursor % 2 === 1;
                    };

                    if (inSystemFunction && autocompleteData) {
                        // Estamos dentro de una funciÃ³n del sistema

                        // Detectar si estamos escribiendo el valor de un parÃ¡metro (despuÃ©s de ":")
                        const paramValueMatch = beforeCursor.match(/(\w+):\s*"([^"]*)$/);

                        if (paramValueMatch) {
                            const paramName = paramValueMatch[1];

                            // Autocompletar valores segÃºn el parÃ¡metro
                            if (paramName === 'status') {
                                suggestions = autocompleteData.statuses.map(status => ({
                                    label: status.label,
                                    kind: monaco.languages.CompletionItemKind.EnumMember,
                                    detail: status.description,
                                    insertText: status.value,
                                    range: range,
                                    sortText: '0' + status.label,
                                }));
                            } else if (paramName === 'userName' || paramName === 'projectManagerName') {
                                suggestions = autocompleteData.users.map(user => ({
                                    label: user.label,
                                    kind: monaco.languages.CompletionItemKind.User,
                                    detail: `Ãrea: ${user.area || 'N/A'}`,
                                    insertText: user.value,
                                    range: range,
                                    sortText: '0' + user.name,
                                }));
                            } else if (paramName === 'projectName') {
                                suggestions = autocompleteData.projects.map(project => ({
                                    label: project.label,
                                    kind: monaco.languages.CompletionItemKind.Module,
                                    detail: 'Proyecto',
                                    insertText: project.value,
                                    range: range,
                                    sortText: '0' + project.name,
                                }));
                            } else if (paramName === 'initiativeName') {
                                suggestions = autocompleteData.initiatives.map(initiative => ({
                                    label: initiative.label,
                                    kind: monaco.languages.CompletionItemKind.Class,
                                    detail: 'Iniciativa EstratÃ©gica',
                                    insertText: initiative.value,
                                    range: range,
                                    sortText: '0' + initiative.name,
                                }));
                            } else if (paramName === 'clientName') {
                                suggestions = autocompleteData.clients.map(client => ({
                                    label: client.label,
                                    kind: monaco.languages.CompletionItemKind.Reference,
                                    detail: 'Cliente',
                                    insertText: client.value,
                                    range: range,
                                    sortText: '0' + client.name,
                                }));
                            } else if (paramName === 'area') {
                                suggestions = autocompleteData.areas.map(area => ({
                                    label: area.label,
                                    kind: monaco.languages.CompletionItemKind.Folder,
                                    detail: 'Ãrea',
                                    insertText: area.value,
                                    range: range,
                                    sortText: '0' + area.value,
                                }));
                            } else if (paramName === 'role') {
                                suggestions = autocompleteData.roles.map(role => ({
                                    label: role.label,
                                    kind: monaco.languages.CompletionItemKind.EnumMember,
                                    detail: role.description,
                                    insertText: role.value,
                                    range: range,
                                    sortText: '0' + role.label,
                                }));
                            }
                        } else if (insideObjectBraces() && !insideQuotes()) {
                            // Estamos dentro de {} pero NO dentro de comillas
                            // Sugerir nombres de parÃ¡metros
                            const availableParams = inSystemFunction.params;

                            suggestions = availableParams.map(param => {
                                let detail = 'ParÃ¡metro';
                                let insertText = `${param}: `;

                                if (param.includes('Name')) {
                                    detail = 'Nombre (autocompletado disponible)';
                                    insertText = `${param}: ""`;
                                } else if (param === 'status') {
                                    detail = 'Estado (autocompletado disponible)';
                                    insertText = `${param}: ""`;
                                } else if (param.startsWith('is')) {
                                    detail = 'Booleano (true/false)';
                                    insertText = `${param}: true`;
                                } else if (param.includes('Date') || param.includes('week')) {
                                    detail = 'Fecha (formato: "YYYY-MM-DD")';
                                    insertText = `${param}: "2025-01-01"`;
                                } else if (param.includes('Min') || param.includes('Max')) {
                                    detail = 'NÃºmero (0-100)';
                                    insertText = `${param}: 0`;
                                }

                                return {
                                    label: param,
                                    kind: monaco.languages.CompletionItemKind.Property,
                                    detail: detail,
                                    insertText: insertText,
                                    range: range,
                                    sortText: '0' + param,
                                };
                            });
                        }
                    }

                    // Si no hay sugerencias contextuales, mostrar funciones
                    if (suggestions.length === 0) {
                        const systemSuggestions = SYSTEM_FUNCTIONS
                            .filter(func => wordUpper === '' || func.name.toUpperCase().includes(wordUpper))
                            .map(func => {
                                // Coincidencia exacta = 0, empieza con = 1, contiene = 2
                                const exactMatch = func.name.toUpperCase() === wordUpper;
                                const startsWithMatch = func.name.toUpperCase().startsWith(wordUpper);
                                const priority = exactMatch ? '0' : (startsWithMatch ? '1' : '2');

                                return {
                                    label: {
                                        label: func.name,
                                        description: func.signature,
                                    },
                                    kind: monaco.languages.CompletionItemKind.Function,
                                    detail: func.detail,
                                    documentation: {
                                        value: func.documentation || func.description,
                                        isTrusted: true,
                                        supportHtml: false
                                    },
                                    insertText: func.name + '()',
                                    range: range,
                                    sortText: priority + '!' + func.name,
                                    filterText: func.name,
                                };
                            });

                        const excelSuggestions = EXCEL_FUNCTIONS
                            .filter(func => wordUpper === '' || func.name.toUpperCase().includes(wordUpper))
                            .map(func => {
                                // Coincidencia exacta = 0, empieza con = 1, contiene = 2
                                const exactMatch = func.name.toUpperCase() === wordUpper;
                                const startsWithMatch = func.name.toUpperCase().startsWith(wordUpper);
                                const priority = exactMatch ? '0' : (startsWithMatch ? '1' : '2');

                                return {
                                    label: {
                                        label: func.name,
                                        description: func.signature,
                                    },
                                    kind: monaco.languages.CompletionItemKind.Function,
                                    detail: func.detail,
                                    insertText: func.name + '()',
                                    range: range,
                                    sortText: priority + '!!' + func.name,
                                    filterText: func.name,
                                };
                            });

                        suggestions = [...systemSuggestions, ...excelSuggestions];
                    }

                    return {
                        suggestions: suggestions,
                        incomplete: false,
                    };
                },
            });

            // Auto-resize
            window.addEventListener('resize', () => {
                editor.layout();
            });
        });

        function saveAndClose() {
            const value = editor.getValue();
            // Enviar mensaje al parent (React)
            window.parent.postMessage({ type: 'FORMULA_SAVE', value: value }, '*');
        }

        // Permitir que el parent pida el valor actual
        window.addEventListener('message', (event) => {
            if (event.data.type === 'GET_VALUE') {
                const value = editor.getValue();
                event.source.postMessage({ type: 'FORMULA_VALUE', value: value }, event.origin);
            }
        });
    </script>
</body>
</html>
