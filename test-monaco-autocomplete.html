<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Monaco Autocomplete</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        #container {
            width: 100%;
            height: 400px;
            border: 1px solid #444;
        }
        #log {
            margin-top: 20px;
            padding: 10px;
            background: #2d2d2d;
            border: 1px solid #444;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #007acc;
        }
        .log-entry.error {
            border-left-color: #f48771;
        }
        .log-entry.success {
            border-left-color: #89d185;
        }
        h1 {
            color: #569cd6;
        }
        .instructions {
            background: #2d2d2d;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Monaco Editor Autocomplete</h1>

    <div class="instructions">
        <h3>Instrucciones de prueba:</h3>
        <ol>
            <li>Escribe diferentes letras: A, B, C, S, etc.</li>
            <li>Observa si aparecen sugerencias de funciones en el dropdown</li>
            <li>Verifica los logs abajo para ver qu√© est√° pasando internamente</li>
            <li>Prueba tambi√©n con J, K, Y para comparar el comportamiento</li>
        </ol>
    </div>

    <div id="container"></div>

    <div id="log">
        <div class="log-entry success">Logs del sistema:</div>
    </div>

    <script src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js"></script>
    <script>
        const log = document.getElementById('log');

        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // Funciones de prueba simplificadas
        const TEST_FUNCTIONS = [
            { name: 'ABS', signature: 'ABS(number)', detail: 'üî¢ Matem√°ticas' },
            { name: 'SUM', signature: 'SUM(numbers...)', detail: 'üî¢ Matem√°ticas' },
            { name: 'AVERAGE', signature: 'AVERAGE(numbers...)', detail: 'üìä Estad√≠sticas' },
            { name: 'COUNT', signature: 'COUNT(values...)', detail: 'üìä Estad√≠sticas' },
            { name: 'MAX', signature: 'MAX(numbers...)', detail: 'üî¢ Matem√°ticas' },
            { name: 'MIN', signature: 'MIN(numbers...)', detail: 'üî¢ Matem√°ticas' },
            { name: 'IF', signature: 'IF(condition, true_value, false_value)', detail: 'üîÄ L√≥gicas' },
            { name: 'YEAR', signature: 'YEAR(date)', detail: 'üìÖ Fechas' },
            { name: 'JOHN', signature: 'JOHN()', detail: 'üß™ Test J' },
            { name: 'KEVIN', signature: 'KEVIN()', detail: 'üß™ Test K' },
            { name: 'YELLOW', signature: 'YELLOW()', detail: 'üß™ Test Y' },
        ];

        require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@latest/min/vs' } });

        require(['vs/editor/editor.main'], function () {
            addLog('‚úÖ Monaco Editor cargado correctamente', 'success');

            // TEST 1: Configuraci√≥n b√°sica sin customizaci√≥n
            addLog('üìù Configuraci√≥n 1: Sin CompletionItemProvider personalizado');

            const editor = monaco.editor.create(document.getElementById('container'), {
                value: '// Escribe aqu√≠: A, S, J, K, Y\n',
                language: 'plaintext',
                theme: 'vs-dark',
                minimap: { enabled: false },
                fontSize: 14,
                quickSuggestions: {
                    other: true,
                    comments: false,
                    strings: true,
                },
                suggestOnTriggerCharacters: true,
                wordBasedSuggestions: 'off',
            });

            addLog('üìã Registrando CompletionItemProvider personalizado...');

            // Registrar provider
            monaco.languages.registerCompletionItemProvider('plaintext', {
                triggerCharacters: ['(', '{', ',', ' ', '"', ':'],

                provideCompletionItems: function(model, position) {
                    const word = model.getWordUntilPosition(position);
                    const range = {
                        startLineNumber: position.lineNumber,
                        endLineNumber: position.lineNumber,
                        startColumn: word.startColumn,
                        endColumn: word.endColumn,
                    };

                    addLog(`üîç provideCompletionItems llamado - Palabra: "${word.word}" (columna: ${word.startColumn}-${word.endColumn})`);

                    const suggestions = TEST_FUNCTIONS.map(func => ({
                        label: {
                            label: func.name,
                            description: func.signature,
                        },
                        kind: monaco.languages.CompletionItemKind.Function,
                        detail: func.detail,
                        insertText: func.name + '()',
                        range: range,
                        sortText: '0' + func.name,
                        filterText: func.name,
                    }));

                    addLog(`‚ú® Devolviendo ${suggestions.length} sugerencias`, 'success');
                    return { suggestions };
                },
            });

            addLog('‚úÖ CompletionItemProvider registrado', 'success');
            addLog('üéØ Listo para probar! Escribe en el editor arriba.', 'success');

            // Monitor de cambios
            editor.onDidChangeModelContent(() => {
                const value = editor.getValue();
                const lines = value.split('\n');
                const lastLine = lines[lines.length - 1];
                if (lastLine && lastLine.trim()) {
                    addLog(`üìù Contenido actual: "${lastLine}"`);
                }
            });

            // Monitor cuando se abre el widget de sugerencias
            editor.onDidChangeCursorPosition((e) => {
                addLog(`üìç Cursor en l√≠nea ${e.position.lineNumber}, columna ${e.position.column}`);
            });
        });
    </script>
</body>
</html>
